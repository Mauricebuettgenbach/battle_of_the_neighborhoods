function updateUrl($form){var parameters=[];$form.find("input:not(:hidden), select").each((function(){parameters.push($(this).serialize())})),window.history.pushState(null,null,$form.attr("action")+"?"+parameters.join("&"))}var losteriaRestaurantsMap;$(document).on("submit","#losteria-restaurants-filter",(function(e){var $form=$(this),url=$(this).data("ajaxaction"),data=$(this).serialize(),mapViewEnabled=$("#losteria-restaurants-mapview").is(":checked");mapViewEnabled&&$(this).hasClass("map-view")?(e.preventDefault(),$.ajax({url:url,data:data,dataType:"html",method:"POST",beforeSend:function(){updateUrl($form)},success:function(data){$("#losteria-restaurants-mapmarkers").replaceWith(data),rebuildOverviewMap()}})):!mapViewEnabled&&$(this).hasClass("list-view")&&(e.preventDefault(),$.ajax({url:url,data:data,dataType:"html",method:"POST",beforeSend:function(){updateUrl($form)},success:function(data){$("#losteria-restaurants-list-wrapper").replaceWith(data),initFoundation($($("#losteria-restaurants-list"))),initFadeInElements()}}))})),$(document).on("ifChecked","#losteria-restaurants-filter input:radio",(function(){$("#losteria-restaurants-filter").submit()})),$(document).on("ifChanged","#losteria-restaurants-mapview",(function(){$("#losteria-restaurants-filter").attr("action",$(this).data("action")).submit()})),$(document).on("change","#losteria-restaurants-filter select",(function(){$("#losteria-restaurants-filter").submit()})),$(document).on("click","#losteria-restaurants-loader",(function(e){e.preventDefault();var ce=$(this).closest("#losteria-restaurants-list-wrapper").data("ce"),url=$(this).attr("href")+"&tx_losteriarestaurants_restaurants[ce]="+ce;$.ajax({url:url,dataType:"html",method:"POST",success:function(data){$("#losteria-restaurants-list").append($(data).find("#losteria-restaurants-list").html()),$("#losteria-restaurants-loader").replaceWith($(data).find("#losteria-restaurants-loader")),initFoundation($($("#losteria-restaurants-list"))),initFadeInElements()}})}));var losteriaRestaurantsMapMarkers=[],losteriaRestaurantsMapMarkerCluster,losteriaRestaurantsMapBounds,losteriaRestaurantsPopupActive;function initMap(){$("#losteria-restaurants-overviewmap").length&&(definePopupClass(),initOverviewMap()),$("#losteria-restaurants-detailmap").length&&initDetailMap()}function initOverviewMap(){var mapContainer=document.getElementById("losteria-restaurants-overviewmap"),options=$(mapContainer).data("options"),mapOptions={center:{lat:parseFloat(options.defaultCenter.lat),lng:parseFloat(options.defaultCenter.lng)},styles:getMapStyle("silver"),mapTypeControl:!1,streetViewControl:!1};addMapMarkers(losteriaRestaurantsMap=new google.maps.Map(mapContainer,mapOptions),options)}function rebuildOverviewMap(){var mapContainer=document.getElementById("losteria-restaurants-overviewmap"),options=$(mapContainer).data("options");clearMapMarkers(),addMapMarkers(losteriaRestaurantsMap,options),losteriaRestaurantsPopupActive&&losteriaRestaurantsPopupActive.close()}function initDetailMap(){var mapContainer=document.getElementById("losteria-restaurants-detailmap"),options=$(mapContainer).data("options"),center=$(mapContainer).data("center"),location={lat:parseFloat(center.lat),lng:parseFloat(center.lng)},mapOptions={zoom:parseInt(options.zoomDetail),center:location,styles:getMapStyle("silver"),mapTypeControl:!1,streetViewControl:!1};addMapMarker(losteriaRestaurantsMap=new google.maps.Map(mapContainer,mapOptions),location,options)}function addMapMarkers(map,options){if(google.maps.Map.prototype.setCenterWithOffset=function(latlng,offsetX,offsetY){var map=this,ov=new google.maps.OverlayView;ov.onAdd=function(){var proj=this.getProjection(),aPoint=proj.fromLatLngToContainerPixel(latlng);aPoint.x=aPoint.x+offsetX,aPoint.y=aPoint.y+offsetY,map.panTo(proj.fromContainerPixelToLatLng(aPoint))},ov.draw=function(){},ov.setMap(this)},losteriaRestaurantsMapBounds=new google.maps.LatLngBounds,$.each(mapMarkers,(function(key,value){var lat=parseFloat(value.lat),lng=parseFloat(value.lng);if(lat&&lng){var location={lat:lat,lng:lng};losteriaRestaurantsMapBounds.extend(location);var icon=value.icon;options.popup=document.getElementById("losteria-restaurants-mapmarker-"+key),addMapMarker(map,location,options,key,icon)}})),losteriaRestaurantsMapMarkers.length){$("#losteria-restaurant-mapoverlay").hide();var clusterOptions={minimumClusterSize:5,styles:[{url:options.iconCluster,width:parseInt(options.iconSizeCluster.width),height:parseInt(options.iconSizeCluster.height),textSize:16,textColor:"white",fontFamily:"Abel Regular",backgroundSize:"30px 30px"}]};losteriaRestaurantsMapMarkerCluster=new MarkerClusterer(map,losteriaRestaurantsMapMarkers,clusterOptions),map.fitBounds(losteriaRestaurantsMapBounds),map.getZoom()>parseInt(options.zoomDetail)&&map.setZoom(parseInt(options.zoomDetail)),$("#losteria-restaurants-overviewmap").data("center")||$("#losteria-restaurants-overviewmap").data("center",{lat:losteriaRestaurantsMapBounds.getCenter().lat(),lng:losteriaRestaurantsMapBounds.getCenter().lng()})}else $("#losteria-restaurant-mapoverlay").show(),map.setCenter($("#losteria-restaurants-overviewmap").data("center")),map.setZoom(parseInt(options.zoomOverview))}function addMapMarker(map,location,options,id,icon){var marker=new google.maps.Marker({position:location,map:map,icon:{url:icon||options.icon,scaledSize:new google.maps.Size(parseInt(options.iconSize.width),parseInt(options.iconSize.height))},optimized:!1});if(losteriaRestaurantsMapMarkers.push(marker),options.popup){var popup=new Popup(new google.maps.LatLng(location.lat,location.lng),options.popup);google.maps.event.addListener(marker,"click",(function(){map.setCenterWithOffset(this.position,0,-250),popup.setMap(map)}))}}function clearMapMarkers(){for(var i=0;i<losteriaRestaurantsMapMarkers.length;i++)losteriaRestaurantsMapMarkers[i].setMap(null);losteriaRestaurantsMapMarkers=[],losteriaRestaurantsMapMarkerCluster.clearMarkers(),losteriaRestaurantsMapBounds=""}function getMapStyle(style){var styles_silver;return"silver"===style?[{elementType:"geometry",stylers:[{color:"#f5f5f5"}]},{elementType:"labels.icon",stylers:[{saturation:-100}]},{elementType:"labels.text.fill",stylers:[{color:"#616161"}]},{elementType:"labels.text.stroke",stylers:[{color:"#f5f5f5"}]},{featureType:"administrative.land_parcel",elementType:"labels.text.fill",stylers:[{color:"#bdbdbd"}]},{featureType:"poi",elementType:"geometry",stylers:[{color:"#eeeeee"}]},{featureType:"poi",elementType:"labels.text.fill",stylers:[{color:"#757575"}]},{featureType:"poi.park",elementType:"geometry",stylers:[{color:"#e5e5e5"}]},{featureType:"poi.park",elementType:"labels.text.fill",stylers:[{color:"#9e9e9e"}]},{featureType:"road",elementType:"geometry",stylers:[{color:"#ffffff"}]},{featureType:"road.arterial",elementType:"labels.text.fill",stylers:[{color:"#757575"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{color:"#dadada"}]},{featureType:"road.highway",elementType:"labels.text.fill",stylers:[{color:"#616161"}]},{featureType:"road.local",elementType:"labels.text.fill",stylers:[{color:"#9e9e9e"}]},{featureType:"transit.line",elementType:"geometry",stylers:[{color:"#e5e5e5"}]},{featureType:"transit.station",elementType:"geometry",stylers:[{color:"#eeeeee"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#c9c9c9"}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{color:"#9e9e9e"}]}]:null}function definePopupClass(){Popup=function(position,content){this.position=position,content.classList.add("popup-bubble-content");var pixelOffset=document.createElement("div");pixelOffset.classList.add("popup-bubble-anchor"),pixelOffset.appendChild(content),this.anchor=document.createElement("div"),this.anchor.classList.add("popup-tip-anchor"),this.anchor.appendChild(pixelOffset),this.anchor.getElementsByClassName("close-button")[0].addEventListener("click",function(){this.close()}.bind(this),!1)},Popup.prototype=Object.create(google.maps.OverlayView.prototype),Popup.prototype.onAdd=function(){this.getPanes().floatPane.appendChild(this.anchor),losteriaRestaurantsPopupActive&&losteriaRestaurantsPopupActive.close(),losteriaRestaurantsPopupActive=this},Popup.prototype.onRemove=function(){this.anchor.parentElement&&(this.anchor.parentElement.removeChild(this.anchor),losteriaRestaurantsPopupActive="")},Popup.prototype.draw=function(){var divPosition=this.getProjection().fromLatLngToDivPixel(this.position),display=Math.abs(divPosition.x)<4e3&&Math.abs(divPosition.y)<4e3?"block":"none";"block"===display&&(this.anchor.style.left=divPosition.x+"px",this.anchor.style.top=divPosition.y+"px"),this.anchor.style.display!==display&&(this.anchor.style.display=display)},Popup.prototype.stopEventPropagation=function(){var anchor=this.anchor;anchor.style.cursor="auto",["click","dblclick","contextmenu","wheel","mousedown","touchstart","pointerdown"].forEach((function(event){anchor.addEventListener(event,(function(e){e.stopPropagation()}))}))},Popup.prototype.close=function(){this.setMap(null)}}